!function(i,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((i=i||self).nvpack=i.nvpack||{},i.nvpack.push=t())}(this,function(){"use strict";class i{constructor(){this.document=window.document,this.browserStatus={isSafari:0,isChrome:0,isFirefox:0,isIE:0,isSafariPush:0,isChromePush:0,isFirefoxPush:0,isEdgePush:0},this.isIncognito=0}getMobileStatus(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?1:0}getBrowser(){var i,t=window.navigator.userAgent;if(document.documentMode||/Edge/.test(t)||/EdgA/.test(t)||/Edg/.test(t))this.browserStatus.isIE=1,i=/Edge/.test(t)||/EdgA/.test(t)?t.substring(t.indexOf("Edg")+5).substring(0,2):t.substring(t.indexOf("Edg")+4).substring(0,2),this.browserStatus.isEdgePush=i>=17?1:0;else if(/chrome/i.test(t))this.browserStatus.isChrome=1,i=/Android|webOS/i.test(navigator.userAgent)?t.split("/")[t.split("/").length-2]:t.split(" ")[t.split(" ").length-2].substr(7),this.browserStatus.isChromePush=i.substring(0,2)>=42?1:0;else if(t.indexOf("Safari")>0&&-1==t.indexOf("Chrome"))this.browserStatus.isSafari=1,i=t.substring(0,t.indexOf("Safari")).substring(t.substring(0,t.indexOf("Safari")).lastIndexOf("/")+1),this.browserStatus.isSafariPush=parseInt(i,10)>=7?1:0;else if(/firefox/i.test(t)){this.browserStatus.isFirefox=1;var n=t.indexOf("Firefox"),s=t.substring(n+8),e=parseInt(""+s,10);e=isNaN(e)?parseInt(navigator.appVersion,10):e,this.browserStatus.isFirefoxPush=e>=44&&!/Android|webOS/i.test(navigator.userAgent)||e>=48&&/Android|webOS/i.test(navigator.userAgent)?1:0}return this.browserStatus}checkIncognito(){return new Promise((i,t)=>{this.isIncognito=0;var n=this,s=window.navigator.userAgent;if(document.documentMode||/Edge/.test(s))window.indexedDB||!window.PointerEvent&&!window.MSPointerEvent?i(!1):(n.isIncognito=1,i(!0));else if(/chrome/i.test(s)){var e=window.RequestFileSystem||window.webkitRequestFileSystem;e?e(window.TEMPORARY,100,()=>i(!1),()=>{n.isIncognito=1,i(!0)}):(n.isIncognito=1,i(!0))}else if(/firefox/i.test(s)){if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var o,r;try{(o=window.indexedDB.open("test")).onerror=function(){return!0}}catch(t){r=!0,n.isIncognito=1,i(!0)}void 0===r&&function(i,t){var n=0,s=!1,e=window.setInterval(function(){i()&&(window.clearInterval(e),t(s)),n++>50&&(window.clearInterval(e),t(s=!0))},10)}(function(){return"done"===o.readyState},function(t){t||(!0===(r=!o.result)?(n.isIncognito=1,i(!0)):i(!1))})}}else if(/Safari/.test(s)){var h;try{window.openDatabase(null,null,null,null)}catch(t){"QuotaExceededError"===t.name?n.isIncognito=0:n.isIncognito=1,h=!0,i(!0)}void 0===h&&(h=!1,n.isIncognito=0,i(!1))}setTimeout(function(){i(!1)},1e3)})}getQueryValue(i){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var s=t[n].split("=");if(s[0]==i)return s[1]}}}class t{constructor(){this.document=window.document}set(i,t,n,s){var e=new Date((new Date).setHours(23,59,59,0));n=n||0==n?"expires="+n:"expires="+e,s=s?"domain=."+s:"",document.cookie=i+"="+t+"; "+n+"; "+s+"; path=/"}get(i){for(var t=i+"=",n=document.cookie.split(";"),s=0;s<n.length;s++){var e=n[s].trim();if(0==e.indexOf(t))return e.substring(t.length,e.length)}return null}remove(i){document.cookie=i+"=; Max-Age=-99999999;"}lsSupport(){return!!window.localStorage}setLS(i,t){return this.lsSupport()&&localStorage.setItem(i,t)}getLS(i){return this.lsSupport()?localStorage.getItem(i):null}duration(i){var t=1,n="Fri, 31 Dec 1999 23:59:59 GMT";if(i)if(501==i)n="Fri, 31 Dec 1999 23:59:59 GMT";else if(0==i)n=0;else{500==i?t=365:i>0&&i<=90&&(t=i);var s=new Date;1!=t&&(t-=1,s.setTime(s.getTime()+24*t*60*60*1e3)),s.setHours(23,59,59,0),n=s}return n}}class n{constructor(i){this.scope=i,this.document=window.document,this.checkValidSafariDomains=""}pushHandler(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this,n=!1;if(t.scope.config.pushDetails){var s=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;if(1!=t.scope.browserController.isIncognito&&!s&&(t.scope.browserController.browserStatus.isChromePush&&1==t.scope.config.pushDetails.chrome||t.scope.browserController.browserStatus.isFirefoxPush&&1==t.scope.config.pushDetails.mozilla||t.scope.browserController.browserStatus.isEdgePush&&1==t.scope.config.pushDetails.microsoftEdge||t.scope.browserController.browserStatus.isSafariPush&&1==t.scope.config.pushDetails.safari)){if(document.location.hostname.indexOf(".nvpush.com")>0)return void t.httpsPermission();t.scope.config.pushDetails.allow_window&&document.getElementById("nv-push-custom-html")&&(document.getElementById("nv-push-custom-html").innerHTML=t.scope.response.pushDetails.allow_window),1==t.scope.config.pushDetails.push_initialize_type&&(n=!0);var e=t.scope.cookieController.get("_nv_push_subscribe");e||(e=null!=t.scope.config.pushDetails.subscriber?t.scope.config.pushDetails.subscriber:e),(1==i||!n&&0==i)&&("https:"==document.location.protocol&&e?t.scope.cookieController.get("_nv_push_domain")&&t.scope.cookieController.get("_nv_push_domain")==document.location.hostname&&!t.scope.browserController.browserStatus.isSafariPush&&"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(i){i.pushManager.getSubscription().then(function(i){try{if(!i)throw"1";if(t.scope.browserController.browserStatus.isFirefox){if(i.endpoint!=e)throw"1"}else if(i.endpoint.split("/").pop()!=e)throw"1"}catch(i){"1"==i&&(e="",t.subscription())}})}):e||t.subscription()),e&&0==i&&(t.scope.pushLeaveIntentController.initialize(e),t.scope.config.pushSubscriber=e)}1==t.scope.config.pushDetails.location_perm&&0==i&&t.scope.geofenceController.ask(),t.scope.config.pushDetails.chicklet&&0!=t.scope.config.pushDetails.chicklet&&0==i&&(t.scope.notificationCenterController.chickLet(t.scope.config.pushDetails,t.scope.notificationCenterController.notificationCenter),t.scope.notificationCenterController.notificationCenter())}(null!=t.scope.config.pushDetails&&1==t.scope.config.pushDetails.hosted&&t.scope.browserController.browserStatus.isChromePush&&1==t.scope.config.pushDetails.chrome||t.scope.browserController.browserStatus.isFirefoxPush&&1==t.scope.config.pushDetails.mozilla||null!=t.scope.config.addToHomeSetting&&1==t.scope.config.addToHomeSetting.allow)&&0==i&&t.scope.serviceWorkerController.registerSw()}subscription(){var i=this;if(i.scope.cookieController.get("_nv_push_error")&&"201"==i.scope.cookieController.get("_nv_push_error")&&Notification.permission&&"default"==Notification.permission&&window.notify_visitors.data.session){var t={cookies:{_nv_push_error:[0,-9999]},domain:this.scope.response.cookieDomain};window.notify_visitors.data.session(t)}i.scope.cookieController.get("_nv_push_error")&&"200"!=i.scope.cookieController.get("_nv_push_error")||(i.scope.config.pushDetails.showChicklet?i.scope.config.showChicklet=i.scope.config.pushDetails.showChicklet:setTimeout(function(){i.askPermission()},1e3*i.scope.config.pushDetails.perm_delay))}askPermission(){if(1==this.scope.config.pushDetails.hosted&&"https:"==document.location.protocol){if("serviceWorker"in navigator&&!this.scope.browserController.browserStatus.isSafariPush){if(!("showNotification"in ServiceWorkerRegistration.prototype))return void this.scope.handlepushSubscription("102");if(!("PushManager"in window))return void this.scope.handlepushSubscription("103");if("denied"===Notification.permission)return void this.scope.handlepushSubscription("201")}void 0!==this.scope.config.pushDetails.safari_website&&(this.checkValidSafariDomains=this.scope.config.pushDetails.safari_website.split(",").find(i=>window.location.href.includes(i))),this.scope.browserController.browserStatus.isSafariPush&&this.checkValidSafariDomains||this.scope.browserController.browserStatus.isFirefoxPush?this.scope.widgetContoller.customPermBox(this.scope.config.pushDetails):"1"!=this.scope.config.pushDetails.desktop_ui&&1!==this.scope.browserController.getMobileStatus()||"1"!=this.scope.config.pushDetails.mobile_ui&&"1"==this.scope.browserController.getMobileStatus()?this.httpsPermission():this.scope.widgetContoller.customPermBox(this.scope.config.pushDetails)}else this.scope.widgetContoller.customPermBox(this.scope.config.pushDetails)}httpsPermission(){this.scope.config.subscribe=this.scope.config.subscribe||{},this.scope.config.subscribe=this.scope.data.auth,this.scope.config.pushSubscribe&&this.scope.config.pushSubscribe.userID&&(this.scope.config.subscribe.userID=this.scope.config.pushSubscribe.userID);var i=this.scope.browserController.getQueryValue("nv_url");this.scope.config.subscribe.pageUrl=i||this.scope.data.setting.pageUrl,this.scope.browserController.browserStatus.isChromePush||this.scope.browserController.browserStatus.isFirefoxPush||this.scope.browserController.browserStatus.isEdgePush?this.scope.serviceWorkerController.launch(this.scope.config):window.safari&&window.safari.pushNotification&&this.scope.browserController.browserStatus.isSafariPush&&this.checkValidSafariDomains&&this.scope.safariWorkerController.launch(this.scope.config.pushDetails)}}var s=i=>{var t=document.getElementById("nv-center-iframe-wrapper");if(t){var n=350;n=i.height<350?Math.min(i.height+13,window.innerHeight-20):n,t.style.height=n+"px",t.style.transition="all 0.3s ease-in"}},e=i=>{if(i.config.nativeBackground_done=0,document.getElementById("nvpush_popup_background"))document.getElementById("nvpush_popup_background").style.display="block";else{var t=0;if(1==i.browserController.browserStatus.isChromePush&&((t=sessionStorage.getItem("_nv_push_background"))||sessionStorage.setItem("_nv_push_background","1")),1!=t){var n=document.createElement("div");if(n.id="nvpush_popup_background",n.innerHTML=i.config.pushDetails.iframe_popup_background.iframe_outer,document.body.appendChild(n),document.getElementById("nvpush_cross")&&i.bindEvent.bind(document.getElementById("nvpush_cross"),"click",function(){document.getElementById("nvpush_popup_background").style.display="none",i.cookieController.set("nvpush_overlay",1)},i.productName),document.getElementById("nvpush_popup_background_iframe")){var s=document.getElementById("nvpush_popup_background_iframe").contentWindow.document;s.open(),s.write(i.config.pushDetails.iframe_popup_background.iframe),s.close()}}}};var o=()=>{var i,t,n=window.document,s=0;return{get:function(e,o,r,h){var a=-1!==e.indexOf("?")?"&":"?";o=o||{};var c=u();for(t in c&&Array.isArray(c)&&c.length>0&&(o.cookieData=c.join(";")),notify_visitors&&notify_visitors.cookie_domain&&(o.cookieDomain=notify_visitors.cookie_domain),o)o.hasOwnProperty(t)&&(a+=encodeURIComponent(t)+"="+encodeURIComponent(o[t])+"&");var d=r+ ++s;return window[d]=function(i){h(i);try{delete window[d]}catch(i){}window[d]=null},function(t){var s=n.createElement("script"),e=!1;s.src=t,s.async=!0,s.onload=s.onreadystatechange=function(){e||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(e=!0,s.onload=s.onreadystatechange=null,s&&s.parentNode&&s.parentNode.removeChild(s))},!i&&(i=n.getElementsByTagName("head")[0]),i.appendChild(s)}(e+a+"js_callback="+d),d},post:function(i,t,n,s,e){e.ajax({url:i,type:"POST",data:t,contentType:!1,processData:!1,success:s})}}},r=()=>{return{bind:function(i,t,n,s){return s&&""!=s&&(window.notify_visitors.eventsRecord=window.notify_visitors.eventsRecord||{},window.notify_visitors.eventsRecord[s]=window.notify_visitors.eventsRecord[s]||[],window.notify_visitors.eventsRecord[s].push({n:t,e:i,c:n})),i.addEventListener?i.addEventListener(t,n):i.attachEvent?i.attachEvent("on"+t,n):void 0},unbind:function(i,t,n){return i.removeEventListener?i.removeEventListener(t,n):i.detachEvent?i.detachEvent("on"+t,n):void 0}}},h=()=>{return function(){if("function"==typeof window.CustomEvent)return!1;function i(i,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var n=document.createEvent("CustomEvent");return n.initCustomEvent(i,t.bubbles,t.cancelable,t.detail),n}i.prototype=window.Event.prototype,window.CustomEvent=i}(),{send:function(i,t){var n=new CustomEvent("notifyvisitors_callback",{detail:{data:i,url:document.location.href,type:t}});window.dispatchEvent(n)}}},a=()=>{var i,t=!0,n={},s=!1;function e(i){s=!0,clearInterval(i),t&&setTimeout(function(){o("selfCall")},10)}function o(i,s,e,r,h){i&&(void 0===h&&(h=!0),t&&("function"==typeof ga?"selfCall"===i?Object.keys(n).forEach(function(i){if(i&&n[i]&&n[i].length>0){for(var t=0;t<n[i].length;t++)ga(i+".send","event",n[i][t][1],n[i][t][2],n[i][t][3],1,{nonInteraction:n[i][t][4]});n[i]=[]}}):ga(i+".send","event",s,e,r,1,{nonInteraction:h}):"selfCall"!==i?(n[i]||(n[i]=[]),n[i].push([i,s,e,r,h])):setTimeout(function(){o("selfCall")},100)))}return{send:o,create:function o(r,h){if(r)if("undefined"!=typeof ga&&ga.loaded&&"function"==typeof ga)try{if(h)ga("create",h,"auto",{name:r});else if(ga.getAll&&Array.isArray(ga.getAll())&&ga.getAll().length>0){var a=ga.getAll()[0].get("trackingId"),c=ga.getByName(r);a&&!c&&(ga("create",a,"auto",{name:r}),e(i))}}catch(i){}else s||i||(i=setInterval(function(){o(r)},250),setTimeout(function(){i&&(t=!1,n={},e(i))},6e4))}}},c=()=>{return{categoryID:function(){for(var i=document.querySelectorAll("[name=nv_push_category]:checked"),t=[],n=0;n<i.length;n++)t.push(i[n].value);return encodeURIComponent(t)}}},u=function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[];if(document&&document.cookie){var n=document.cookie.split(";");"all"===i&&(t=n),Array.isArray(i)&&n&&n.length>0&&(t=n.filter(function(t){var n=t.trim().split("=")[0];return!!i.includes(n)||0===n.indexOf("_nv_")}))}return t};class d{constructor(i){this.scope=i,this.document=window.document,this.callbackNotifyEvent=h()}launch(i){var t=this;if("serviceWorker"in navigator){var n=null!=i.pushDetails&&i.pushDetails.sw_path?i.pushDetails.sw_path:i.addToHomeSetting&&i.addToHomeSetting.sw_path?i.addToHomeSetting.sw_path:"/service-worker.js",s=i.addToHomeSetting&&i.addToHomeSetting.sw_scope?i.addToHomeSetting.sw_scope:"/",e=t.scope.config.addToHomeSetting.webapp_version.trim(),o=e?-1==n.indexOf("?")?"?nvhash="+e:"&nvhash="+e:"";navigator.serviceWorker.register(n+o,{scope:s}).then(function(i){t.askPushPermission(i)},function(i){console.log("Service worker registration failed:",i)})}else t.scope.handlepushSubscription("101")}initializeState(i){var t=this;i?i.pushManager.getSubscription().then(function(n){n?t.sendToServer(n):t.subscribe(i)}).catch(function(i){console.log("Error during getSubscription()",i),t.scope.handlepushSubscription("104")}):navigator.serviceWorker.ready.then(function(i){i.pushManager.getSubscription().then(function(n){n?t.sendToServer(n):t.subscribe(i)}).catch(function(i){console.log("Error during getSubscription()",i),t.scope.handlepushSubscription("104")})}).catch(function(i){"7446"==t.scope.data.auth.bid&&t.scope.sendLogs(i)})}askPushPermission(i){var t=this;return new Promise(function(i,n){var s=Notification.requestPermission(function(t){i(t)});if(s){var o=t.scope.cookieController.get("nvpush_overlay");t.scope.config.pushDetails.allow_bg&&"1"!==o&&"granted"!==Notification.permission&&e(t.scope),s.then(i,n)}}).then(function(n){return document.getElementById("nvpush_popup_background")&&(t.scope.config.nativeBackgroundDone=1,document.getElementById("nvpush_popup_background").style.display="none"),"denied"===Notification.permission?(t.scope.browserController.browserStatus.isFirefox?(t.scope.sendStats("mozilla_denied",!1),t.scope.gapush_push("nv_push_denied","mozilla",!1)):(t.scope.sendStats("chrome_denied",!1),t.scope.gapush_push("nv_push_denied","chrome",!1)),void t.scope.handlepushSubscription("201")):"default"===Notification.permission?(t.scope.handlepushSubscription("202"),void(t.scope.browserController.browserStatus.isFirefox?(t.scope.sendStats("mozilla_closed",!1),t.scope.gapush_push("nv_push_closed","mozilla",!1)):(t.scope.sendStats("chrome_closed",!1),t.scope.gapush_push("nv_push_closed","chrome",!1)))):void t.initializeState(i)}).catch(function(i){console.log("Error during getting permissions",i),"7446"==t.scope.data.auth.bid&&t.scope.sendLogs(i)})}subscribe(i){var t=this,n=i,s={userVisibleOnly:!0},e="0";t.scope.config.pushDetails.fcm_public&&(e="1",s.applicationServerKey=t.urlBase64ToUint8Array(t.scope.config.pushDetails.fcm_public)),n.pushManager.subscribe(s).then(function(i){return document.getElementById("nvpush_popup_background_loader")&&(document.getElementById("nvpush_popup_background_loader").style.display="block"),document.getElementById("nvpush_popup_background")&&(t.scope.config.nativeBackgroundDone=1,document.getElementById("nvpush_popup_background").style.display="none"),t.scope.browserController.browserStatus.isFirefox?t.scope.gapush_push("nv_push_allowed","mozilla",!1):t.scope.gapush_push("nv_push_allowed","chrome",!1),i.vapid=e,t.sendToServer(i)}).catch(function(i){console.log(i),"7446"==t.scope.data.auth.bid&&t.scope.sendLogs(i)})}sendToServer(i){if(i.endpoint){var t=JSON.parse(JSON.stringify(i));if(t.keys&&(t.keys.p256dh&&(this.scope.config.subscribe.pkey=this.scope.data.setting.pkey=t.keys.p256dh),t.keys.auth&&(this.scope.config.subscribe.authkey=this.scope.data.setting.authkey=t.keys.auth)),i.vapid&&(this.scope.config.subscribe.vapid=i.vapid),this.scope.browserController.browserStatus.isFirefox)this.scope.config.subscribe.endpoint=i.endpoint,this.scope.config.subscribe.category=this.scope.nvPushCategory.categoryID(),window.notify_visitors.Push.data.add_to_home_details&&window.notify_visitors.Push.data.add_to_home_details.app_id&&(this.scope.config.subscribe.app_id=this.scope.data.setting.app_id=window.notify_visitors.Push.data.add_to_home_details.app_id),this.scope.getJSONP.get(this.scope.config.urls.mozilla_subscribe,this.scope.config.subscribe,this.scope.callbackName,this.mozillaHandleResponse.bind(this));else if(this.scope.browserController.browserStatus.isIE){if(i.endpoint.indexOf("googleapis.com/fcm/send")>0)return void this.scope.handlepushSubscription("105");var n=i.endpoint;this.scope.config.subscribe.category=this.scope.nvPushCategory.categoryID(),this.scope.config.subscribe.subscriptionId=this.scope.data.setting.subscriptionId=n,window.notify_visitors.Push.data.add_to_home_details&&window.notify_visitors.Push.data.add_to_home_details.app_id&&(this.scope.config.subscribe.app_id=this.scope.data.setting.app_id=window.notify_visitors.Push.data.add_to_home_details.app_id),this.scope.getJSONP.get(this.scope.config.urls.edge_subscribe,this.scope.config.subscribe,this.scope.callbackName,this.chromeHandleResponse.bind(this))}else{if(-1==i.endpoint.indexOf("googleapis.com/gcm/send")&&-1==i.endpoint.indexOf("googleapis.com/fcm/send"))return void this.scope.handlepushSubscription("105");var s=i.subscriptionId?i.subscriptionId:i.endpoint.split("/").pop();this.scope.config.subscribe.category=this.scope.nvPushCategory.categoryID(),this.scope.config.subscribe.subscriptionId=this.scope.data.setting.subscriptionId=s,window.notify_visitors.Push.data.add_to_home_details&&window.notify_visitors.Push.data.add_to_home_details.app_id&&(this.scope.config.subscribe.app_id=this.scope.data.setting.app_id=window.notify_visitors.Push.data.add_to_home_details.app_id),this.scope.getJSONP.get(this.scope.config.urls.chrome_subscribe,this.scope.config.subscribe,this.scope.callbackName,this.chromeHandleResponse.bind(this))}}else this.scope.handlepushSubscription("105")}chromeHandleResponse(i){i.subscriber&&(i.campaignCookie&&window.notify_visitors.data.session&&window.notify_visitors.data.session(i.campaignCookie),i.callback_data&&this.callbackNotifyEvent.send(i.callback_data,"push_subscription"),this.scope.handlepushSubscription("200",i.subscriber))}mozillaHandleResponse(i){i.subscriber&&(i.campaignCookie&&window.notify_visitors.data.session&&window.notify_visitors.data.session(i.campaignCookie),i.callback_data&&this.callbackNotifyEvent.send(i.callback_data,"push_subscription"),this.scope.handlepushSubscription("200",i.subscriber))}registerSw(){if("https:"==document.location.protocol&&(this.scope.browserController.browserStatus.isChromePush||this.scope.browserController.browserStatus.isFirefoxPush)&&"serviceWorker"in navigator){var i=null!=this.scope.config.pushDetails&&this.scope.config.pushDetails.sw_path?this.scope.config.pushDetails.sw_path:this.scope.config.addToHomeSetting&&this.scope.config.addToHomeSetting.sw_path?this.scope.config.addToHomeSetting.sw_path:"/service-worker.js",t=this.scope.config.addToHomeSetting&&this.scope.config.addToHomeSetting.sw_scope?this.scope.config.addToHomeSetting.sw_scope:"/",n=this.scope.config.addToHomeSetting.webapp_version.trim(),s=n?-1==i.indexOf("?")?"?nvhash="+n:"&nvhash="+n:"";navigator.serviceWorker.register(i+s,{scope:t}),this.scope.cookieController.get("_nv_push_domain")&&this.scope.cookieController.get("_nv_push_domain")==document.location.hostname&&"granted"!==Notification.permission&&null!=this.scope.config.pushDetails&&"1"==this.scope.config.pushDetails.hosted&&this.unSubscribe()}}unSubscribe(){if(this.scope.config.pushSubscriber){if(window.notify_visitors.data.session){var i={cookies:{_nv_push_error:[0,-9999],_nv_push_subscribe:[0,-9999]},domain:this.scope.response.cookieDomain};window.notify_visitors.data.session(i)}this.scope.config.unSubscribe={},this.scope.config.unSubscribe=this.scope.data.auth,this.scope.config.unSubscribe.subscriptionID=this.scope.config.pushSubscriber,this.scope.config.pushSubscriber="";var t=this.scope.config.urls.push_unsub;this.scope.browserController.browserStatus.isFirefox&&(t=this.scope.config.urls.push_unsub_moz),window.notify_visitors.Push.data.add_to_home_details&&window.notify_visitors.Push.data.add_to_home_details.app_id&&(this.scope.config.unSubscribe.app_id=this.scope.data.setting.app_id=window.notify_visitors.Push.data.add_to_home_details.app_id),this.scope.getJSONP.get(t,this.scope.config.unSubscribe,this.scope.callbackName,this.unsubscribeResponse.bind(this))}}urlBase64ToUint8Array(i){var t=(i+"=".repeat((4-i.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t);return Uint8Array.from([...n].map(i=>i.charCodeAt(0)))}unsubscribeResponse(i){}}class v{constructor(i){this.scope=i,this.document=window.document}launch(i){i.safari_push_id=i.safari_push_id?i.safari_push_id:"web.com.notifyvisitors";var t=window.safari.pushNotification.permission(i.safari_push_id);switch(t.permission){case"default":this.requestPermissions(i);break;case"granted":this.sendToServer(t.deviceToken)}}requestPermissions(i){var t=this;i.safari_push_id=i.safari_push_id?i.safari_push_id:"web.com.notifyvisitors",window.safari.pushNotification.requestPermission(t.scope.config.urls.safari_certificate,i.safari_push_id,{id:t.scope.data.auth.bid,shopify_shop:t.scope.data.shopify_shop?t.scope.data.shopify_shop:""},function(i){switch(i.permission){case"granted":t.sendToServer(i.deviceToken),t.scope.gapush_push("nv_push_allowed","safari",!1);break;case"denied":t.scope.sendStats("safari_denied",!1),t.scope.gapush_push("nv_push_denied","safari",!1),t.scope.handlepushSubscription("201")}})}sendToServer(i){this.scope.config.subscribe.subscriptionId=i,this.scope.config.subscribe.category=this.scope.nvPushCategory.categoryID(),window.notify_visitors.Push.data.add_to_home_details&&window.notify_visitors.Push.data.add_to_home_details.app_id&&(this.scope.config.subscribe.app_id=this.scope.data.setting.app_id=window.notify_visitors.Push.data.add_to_home_details.app_id),this.scope.getJSONP.get(this.scope.config.urls.safari_subscribe,this.scope.config.subscribe,this.scope.callbackName,this.handleResponse.bind(this))}handleResponse(i){i.subscriber&&(i.campaignCookie&&window.notify_visitors.data.session&&window.notify_visitors.data.session(i.campaignCookie),this.scope.handlepushSubscription("200",i.subscriber))}}class _{constructor(i){this.scope=i,this.document=window.document}customPermBox(i){var t=document.createElement("div");t.innerHTML="1"==this.scope.browserController.getMobileStatus()?i.perm_box_view.mobile:i.perm_box_view.desktop,t.id="notify-visitors-push-confirm-popup",document.body.firstChild?document.body.insertBefore(t,document.body.firstChild):document.body.appendChild(t),this.pushConfirmInitialize(i),this.scope.browserController.browserStatus.isFirefox?this.scope.gapush_push("nv_push_permbox_shown","mozilla",!0):this.scope.gapush_push("nv_push_permbox_shown","chrome",!0)}customAddtoHSBox(i){var t,n=this,s=this.scope.cookieController.get("_nv_pwa_banner_"+i.app_id+"_x"),e=document.getElementById("notify-visitors-pwa-install-popup-"+i.app_id);if(1==s||e)return!1;var o,r=document.createElement("div");r.id="notify-visitors-pwa-install-popup-"+i.app_id,r.innerHTML=i.nv_banner.content,i.nv_banner.overlay&&((t=document.createElement("div")).setAttribute("id","nv_js-pwa-modal-overlay-"+i.app_id),t.style.cssText=i.nv_banner.overlay,document.body.firstChild?document.body.insertBefore(t,document.body.firstChild):document.body.appendChild(t)),document.body.firstChild?document.body.insertBefore(r,document.body.firstChild):document.body.appendChild(r),o=document.getElementById("nv_js-pwa-close-button-"+i.app_id),n.scope.bindEvent.bind(o,"click",function(){return n.close(i.app_id)},"pwa_banner")}close(i){var t=document.getElementById("notify-visitors-pwa-install-popup-"+i);t&&t.parentNode.removeChild(t);var n=document.getElementById("nv_js-pwa-modal-overlay-"+i);n&&n.parentNode.removeChild(n);var s=new Date;s.setTime(s.getTime()+2592e6);var e=s.toGMTString();this.scope.cookieController.set("_nv_pwa_banner_"+i+"_x",1,e)}pushConfirmInitialize(i){var t=this,n=document.getElementById("notify-visitors-confirm-popup-btn-positive");t.scope.bindEvent.bind(n,"click",()=>(document.getElementById("notify-visitors-push-confirm-popup")&&(document.getElementById("notify-visitors-push-confirm-popup").style.display="none"),t.pushConfirmPositive()),t.scope.productName);var s=document.getElementById("notify-visitors-confirm-popup-btn-negative");t.scope.bindEvent.bind(s,"click",()=>(document.getElementById("notify-visitors-push-confirm-popup")&&(document.getElementById("notify-visitors-push-confirm-popup").style.display="none"),t.pushConfirmNegative()),t.scope.productName)}pushConfirmPositive(){this.scope.browserController.browserStatus.isFirefox?this.scope.gapush_push("nv_push_permbox_allow","mozilla",!1):this.scope.gapush_push("nv_push_permbox_allow","chrome",!1),1==this.scope.config.pushDetails.hosted&&"https:"==document.location.protocol?this.scope.pushHandlerController.httpsPermission():this.pushAllowWindow()}pushAllowWindow(){var i=Number(screen.width/2-300),t=Number(screen.height/2-300),n="";1==this.scope.config.pushDetails.hosted?(n=this.scope.config.pushDetails.hosted_link,n+=-1===n.indexOf("?")?"?":"&",n=-1!==(n+="nv_url="+encodeURIComponent(this.scope.data.setting.pageUrl)).indexOf("notifyvisitors_push/chrome/custom.html")?n+"&bid="+this.scope.data.auth.bid+"&bid_e="+this.scope.data.auth.bid_e+"&t="+this.scope.data.auth.t:n):(n=this.scope.config.urls.permissionBox+"?bid="+this.scope.data.auth.bid+"&bid_e="+this.scope.data.auth.bid_e+"&t="+this.scope.data.auth.t,this.scope.config.pushSubscribe&&this.scope.config.pushSubscribe.userID&&(n+="&userID="+this.scope.config.pushSubscribe.userID),n+="&nv_url="+this.scope.data.setting.pageUrl),window.open(n,"_blank","width=500, height=500,top="+t+", left="+i)}pushConfirmNegative(){var i=this.scope.response.cookieDomain?this.scope.response.cookieDomain:"",t=this.scope.cookieController.get("_nv_push_times");if(t=(t=parseInt(t))?t+1:1,window.notify_visitors.data.session){var n={cookies:{_nv_push_neg:["1",0],_nv_push_times:[t,43200]},domain:i};window.notify_visitors.data.session(n)}this.scope.browserController.browserStatus.isFirefox?this.scope.gapush_push("nv_push_permbox_denied","mozilla",!1):this.scope.gapush_push("nv_push_permbox_denied","chrome",!1)}}class p{constructor(i){this.scope=i,this.document=window.document,this.notificationCenterInterval}chickLet(i,t){if(1==i.chicklet){var n=document.getElementById("notify-visitors-push-chicklet");n&&n.parentNode.removeChild(n);var s=document.createElement("style");s.innerHTML=i.chicklet_view.style,s.setAttribute("class","notify-visitors-element"),document.head.appendChild(s);var e=document.createElement("div");e.innerHTML=screen.width>600?i.chicklet_view.desktop:i.chicklet_view.mobile,setTimeout(function(){document.getElementById("nv-hover_text")&&(document.getElementById("nv-hover_text").className="nv-text-point nv-chicklet_none")},5e3),e.id="notify-visitors-push-chicklet",e.onclick=t.bind(this),document.body.firstChild?document.body.insertBefore(e,document.body.firstChild):document.body.appendChild(e)}}notificationCenter(){var i=this,t=document.getElementById("nv_notification_center_button");"2"!=i.scope.config.pushDetails.chicklet&&"3"!=i.scope.config.pushDetails.chicklet||(t=i.findNotificationCenterElement()),t?i.notificationCenterCall(t):(i.notificationCenterInterval=setInterval(function(){(t=i.findNotificationCenterElement())&&(i.notificationCenterCall(t),clearInterval(i.notificationCenterInterval))},1e3),setTimeout(function(){i.notificationCenterInterval&&clearInterval(i.notificationCenterInterval)},5e3))}findNotificationCenterElement(){var i,t=document.querySelectorAll("[id='"+this.scope.config.pushDetails.chicklet_onclick_id+"']");if(t.length>=2){for(var n=0;n<t.length;n++)if(0!==t[n].offsetWidth&&0!==t[n].offsetHeight){i=t[n];break}}else i=document.getElementById(this.scope.config.pushDetails.chicklet_onclick_id);return i}notificationCenterCall(i){var t=this;t.scope.config.pushDetails.notification_center_count_css&&t.ncCounter(t.scope.config.pushDetails,i);var n=document.createElement("div");if(n.id="notify-visitors-notification_center_iframe_parent_div",i.appendChild(n),"3"==t.scope.config.pushDetails.chicklet&&1!==t.scope.browserController.getMobileStatus()){i.onmouseover=function(){t.ncHideCounter(),t.nvCenterData()};var s=document.getElementById("notify-visitors-notification_center_iframe_parent_div");s&&(i.onmouseleave=function(){s.onmouseover?s.onmouseout=function(){s.style.display="none"}:s.style.display="none"})}else i.onclick=function(){t.ncHideCounter(),1===t.scope.browserController.getMobileStatus()?t.mobNvCenterData():t.nvCenterData()}}mobNvCenterData(){var i=this;if(document.getElementById("nvpush_nvcenter_mobileiframe_parent"))i.mobNvCenterVisibility();else{var t=document.createElement("div");if(t.innerHTML=i.scope.config.pushDetails.notification_center_iframe.iframe,document.body.appendChild(t),document.getElementById("nvpush_notification_center_mobile_iframe")){if(null!=i.scope.config.pushDetails.notification_center_iframe.resize&&"1"===i.scope.config.pushDetails.notification_center_iframe.resize){var n=document.getElementById("nvpush_notification_center_mobile_iframe").scrollHeight;n<=300&&(n+=75,document.getElementById("nvpush_nvcenter_mobileiframe_parent").style.height=n+"px")}var s=document.getElementById("nvpush_notification_center_mobile_iframe").contentWindow.document;s.open(),s.write(i.scope.config.pushDetails.notification_center_iframe_svg),s.close()}setTimeout(function(){i.centerJsonpCall(i,!0)},1)}}mobNvCenterResponse(i){if(document.getElementById("nvpush_notification_center_mobile_iframe")){var t=document.getElementById("nvpush_notification_center_mobile_iframe").contentWindow.document;t.open(),t.write(i.view),t.close()}}mobNvCenterVisibility(){var i=document.getElementById("nvpush_nvcenter_mobileiframe_parent");i&&(i.style.display="block"===i.style.display?"none":"block")}nvCenterData(i){var t=this;if(document.getElementById("nvpush_notification_center_iframe"))"3"==t.scope.config.pushDetails.chicklet&&1!==t.scope.browserController.getMobileStatus()?document.getElementById("notify-visitors-notification_center_iframe_parent_div").style.display="block":t.nvCenterVisibility();else{if(document.getElementById("notify-visitors-notification_center_iframe_parent_div").innerHTML=this.scope.config.pushDetails.notification_center_iframe.iframe,document.getElementById("nvpush_notification_center_iframe")){var n=document.getElementById("nvpush_notification_center_iframe").contentWindow.document;n.open(),n.write(t.scope.config.pushDetails.notification_center_iframe_svg),n.close()}setTimeout(function(){t.centerJsonpCall(t,!1)},1)}}nvCenterResponse(i){if(document.getElementById("nvpush_notification_center_iframe")){var t=document.getElementById("nvpush_notification_center_iframe").contentWindow.document;t.open(),t.write(i.view),t.close()}}nvCenterVisibility(){var i=document.getElementById("nvpush_notification_center_iframe");"visible"===i.style.visibility?(i.style.visibility="hidden",document.getElementById("notify-visitors-notification_center_iframe_parent_div").style.display="none",document.getElementById("nv-pick").style.visibility="hidden"):(i.style.visibility="visible",document.getElementById("notify-visitors-notification_center_iframe_parent_div").style.display="block",document.getElementById("nv-pick").style.visibility="visible")}centerJsonpCall(i,t){i.scope.config.pushCenter={},i.scope.config.pushCenter=i.scope.data.auth,null!=i.scope.config.pushSubscriber&&(i.scope.config.pushCenter.subscriptionID=i.scope.config.pushSubscriber),null!=i.scope.config.showChicklet&&(i.scope.config.pushCenter.showChicklet=i.scope.config.showChicklet),i.scope.getJSONP.get(i.scope.config.urls.push_center,i.scope.config.pushCenter,i.scope.callbackName,t?i.mobNvCenterResponse:i.nvCenterResponse.bind(this))}ncCounter(i,t){var n=this.scope.cookieController.getLS("nv_center_count_date");!n&&(n="1970-01-01 00:00:00");var s=i.notification_center_count,e=0;if(s.length)for(var o=0;o<s.length;o++)s[o]>n&&e++;if(e>0){var r=document.createElement("div"),h=i.notification_center_count_css;r.id="_nv-notification-count",r.innerHTML='<div class="_nv-notification-inner-count">'+e+"</div>"+h,t.appendChild(r)}}ncHideCounter(){var i=this.ncCounterDateFormat();this.scope.cookieController.setLS("nv_center_count_date",i);var t=document.getElementById("_nv-notification-count");t&&(t.style.display="none")}ncCounterDateFormat(){var i=new Date;return i.getFullYear()+"-"+("0"+(i.getMonth()+1)).slice(-2)+"-"+("0"+i.getDate()).slice(-2)+" "+(("0"+i.getHours()).slice(-2)+":"+("0"+i.getMinutes()).slice(-2)+":"+("0"+i.getSeconds()).slice(-2))}}class l{constructor(i){this.scope=i,this.askError=this.askError.bind(this)}location(){var i=function(i){"granted"==i.state&&navigator.geolocation.getCurrentPosition(i=>{var n=(new Date).toJSON().slice(0,10).replace(/-/g,"/");if(!t.scope.cookieController.getLS("nvpush_geofence")||t.scope.cookieController.getLS("nvpush_geofence")!=n){t.scope.config.geofencing=t.scope.data.auth,t.scope.config.geofencing.latitude=i.coords.latitude,t.scope.config.geofencing.longitude=i.coords.longitude,t.scope.config.geofencing.subscriptionID=t.scope.config.pushSubscriber,1==t.scope.browserController.browserStatus.isChrome?t.scope.config.geofencing.platform="1":1==t.scope.browserController.browserStatus.isFirefox?t.scope.config.geofencing.platform="2":1==t.scope.browserController.browserStatus.isSafari&&(t.scope.config.geofencing.platform="5");var s=0;if(t.scope.cookieController.getLS("nvpush_geo_coord")){var e=JSON.parse(t.scope.cookieController.getLS("nvpush_geo_coord")),o=e.coords.lat;e.coords.long.toPrecision(6)!=i.coords.longitude.toPrecision(6)&&o.toPrecision(6)!=i.coords.latitude.toPrecision(6)&&n!=e.timestamp&&(s=1)}else s=1;if(1==s){var r={coords:{lat:i.coords.latitude,long:i.coords.longitude},timestamp:n};t.scope.cookieController.setLS("nvpush_geo_coord",JSON.stringify(r)),t.scope.getJSONP.get(t.scope.config.urls.geofencing,t.scope.config.geofencing,t.scope.callbackName,t.handleGeoResponse.bind(t))}}})},t=this;navigator.geolocation&&navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(t=>{i(t)}):navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(i){},function(t){if(1!=t.code){var n={state:"granted"};i(n)}},{timeout:0})}handleGeoResponse(i){i.geofence&&1!==i.geofence&&this.scope.cookieController.setLS("nvpush_geofence",(new Date).toJSON().slice(0,10).replace(/-/g,"/"))}ask(){this.scope.cookieController.get("nv_geo_neg")||navigator.geolocation.getCurrentPosition(this.askSuccess,this.askError)}askSuccess(){}askError(){this.scope.cookieController.setLS("nv_geo_neg",1)}}class f{constructor(i){this.scope=i}initialize(i){if(this.scope.response&&this.scope.response.notification){var t={};return(t=Object.assign({},this.scope.data.auth)).notificationID=this.scope.response.notification.notificationID,t.time=parseInt(this.scope.response.notification.leaveIntent_time&&0!=this.scope.response.notification.leaveIntent_time?60*this.scope.response.notification.leaveIntent_time:60),t.subscriptionID=i,t.tokens&&"object"==typeof t.tokens&&(t.tokens=JSON.stringify(t.tokens)),this.scope.browserController.browserStatus.isChrome?t.platform=1:this.scope.browserController.browserStatus.isFirefox?t.platform=2:this.scope.browserController.browserStatus.isSafari&&(t.platform=5),void this.desktopLeaveIntentCall(t)}}desktopLeaveIntentCall(i){var t=this;return t.scope.bindEvent.bind(document,"mouseout",function(n){var s=(n=n||window.event).relatedTarget||n.toElement;if((!s||"HTML"==s.nodeName)&&n.pageY-window.pageYOffset<=1){var e=new Date,o=Math.floor(parseInt(e.getTime(),10)/1e3),r=o;i.time>120&&(r=o+parseInt(i.time,10));var h=parseInt(t.scope.cookieController.get("_nv_push_li_"+i.notificationID));h?o<h&&(t.scope.cookieController.set("_nv_push_li_"+i.notificationID,r),t.scope.getJSONP.get(t.scope.config.urls.schedule_push,i,"push_leave_intent",t.leaveIntentResponse.bind(this))):(t.scope.cookieController.set("_nv_push_li_"+i.notificationID,r),t.scope.getJSONP.get(t.scope.config.urls.schedule_push,i,"push_leave_intent",t.leaveIntentResponse.bind(this)))}},t.scope.productName),this}leaveIntentResponse(i){}}var w=()=>{function i(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return i()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i()},m="https://push.notifyvisitors.com/",b="https://push.notifyvisitors.com/",g={permissionBox:b+"brand/t1/permissionBox",schedule_push:m+"brand/t1/schedule",chrome_subscribe:m+"brand/t1/chrome_subscribe",safari_subscribe:m+"brand/t1/safari_subscribe",mozilla_subscribe:m+"brand/t1/mozilla_subscribe",edge_subscribe:m+"brand/t1/edge_subscribe",native_thanks:b+"brand/t1/thanksWindow",push_stats:b+"brand/t1/stats",push_logstat:b+"brand/t1/log_stat",push_unsub:b+"brand/t1/unsubscribe",push_unsub_moz:b+"brand/t1/unsubscribe_mozilla",push_center:b+"brand/t1/notifications",geofencing:b+"brand/t1/geofencing",safari_certificate:b+"safari/hosted"},k=new Date,y=[],S=null;class C{constructor(s){this.response={},this.config=this.config||{},this.data=this.data||{},this.config.pushSubscribe=this.config.pushSubscribe||{},this.getJSONP=o(),this.bindEvent=r(),this.gaEvent=a(),this.callbackNotifyEvent=h(),this.nvPushCategory=c(),this.callbackName="nvpush_json",this.productName="push",this.cookieController=new t,this.browserController=new i,this.pushHandlerController=new n(this),this.serviceWorkerController=new d(this),this.safariWorkerController=new v(this),this.widgetContoller=new _(this),this.notificationCenterController=new p(this),this.geofenceController=new l(this),this.pushLeaveIntentController=new f(this),this.addToHomeBtnClickHandler=this.addToHomeBtnClickHandler.bind(this),this.beforeInstallPromptHandler=this.beforeInstallPromptHandler.bind(this),this.beforeInstallPromptHandlerDiffer=this.beforeInstallPromptHandlerDiffer.bind(this),this.beforeInstallPromptEvent=null,this.addToHomeBtn,this.webappShown=0,this.addToHSsession=this.addToHSsession.bind(this),this.webappSession=0,this.checkAuth(s),this.trackingID=s&&s.gaEvents&&s.gaEvents.trackingID?s.gaEvents.trackingID:"",this.gaEvent.create("NV_PushNoitfication",this.trackingID)}checkAuth(i){this.response=i,null!=i.auth&&this.browserController.checkIncognito().then(function(){null!=i.async&&!1!==i.async?handleWindowLoad():this.init()}.bind(this))}handleWindowLoad(){"complete"==document.readyState?this.init():this.bindEvent.bind(window,"load",init,this.productName)}init(){if(nvpack.config=nvpack.config||{},nvpack.config.p)return!1;nvpack.config.p=!0,this.config.urls=g,this.data.auth=this.response.auth||{},this.data.setting=this.response.auth||{},this.data.shopify_shop=this.response.shopify_shop?this.response.shopify_shop:"",this.data.auth.ruleData&&(this.data.setting.ruleData=this.data.auth.ruleData=this.response.ruleData),this.response.tokens&&(this.data.setting.tokens=this.data.auth.tokens=this.response.tokens),this.data.setting.trafficSource=this.data.auth.trafficSource=document.referrer,this.data.setting.pageUrl=this.data.auth.pageUrl=document.location,this.data.setting.gmOffset=this.data.auth.gmOffset=60*k.getTimezoneOffset()*-1,this.data.setting.incognito=this.browserController.isIncognito,this.data.setting.screenWidth=this.data.auth.screenWidth=screen.width,this.data.setting.screenHeight=this.data.auth.screenHeight=screen.height,this.messageListener(),this.load(),this.callbackNotifyEvent.send("push_init","loadscript")}load(){if("fail"==this.response.Authentication)return!1;this.browserController.getBrowser(),window.notify_visitors.po=window.notify_visitors.po||{},window.notify_visitors.po.pushConfirmTMessage=this.widgetContoller.pushConfirmTMessage,window.notify_visitors.po.updateUserIdSubscription=this.updateUserIdSubscription.bind(this),window.notify_visitors.po.customPermissionBox=this.pushHandlerController.pushHandler.bind(this.pushHandlerController),!1===(window!==window.parent)&&(""!=this.response.cookie_domain&&(this.data.cookie_domain=this.response.cookie_domain),this.config.addToHomeSetting=this.response.add_to_home_details?this.response.add_to_home_details:{},this.config.pushDetails=this.response.pushDetails?this.response.pushDetails:{},this.config.pushLabel=!!this.response.white_label&&this.response.white_label,(this.response.pushDetails||this.response.add_to_home_details)&&this.pushHandlerController.pushHandler(),this.response.add_to_home_details&&(1==this.response.add_to_home_details.allow||1==this.response.add_to_home_details.desktop_status)&&(window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||document.location.href.indexOf("webapp=1")>1||this.response.isPwa&&1==this.response.isPwa)?this.addToHSsession():this.response.add_to_home_details&&1==this.response.add_to_home_details.twa_status&&this.response.isPwa&&2==this.response.isPwa&&this.addToHSsession(),this.athsMessageListener())}addToHSsession(){window.sessionStorage.getItem("nv_web_app_session")||(window.sessionStorage.setItem("nv_web_app_session",w()),this.gapush_push("web_app_opened",this.data.setting.app_id||"",!0),this.callbackNotifyEvent.send("opened","web_app_event")),this.response.newSess&&this.sendStats("web_app_opened")}updateUserIdSubscription(i){if(i&&this.cookieController.get("_nv_push_subscribe")){var t,n=this.cookieController.get("_nv_push_subscribe"),s=Object.assign({},this.data.auth);this.browserController.browserStatus.isChrome&&1==this.response.pushDetails.chrome?(t=this.config.urls.chrome_subscribe,s.subscriptionId=n):this.browserController.browserStatus.isFirefox&&1==this.response.pushDetails.mozilla?(t=this.config.urls.mozilla_subscribe,s.endpoint=n):this.browserController.browserStatus.isSafari&&1==this.response.pushDetails.safari?(t=this.config.urls.safari_subscribe,s.subscriptionId=n):this.browserController.browserStatus.isIE&&1==this.response.pushDetails.microsoftEdge&&(t=this.config.urls.edge_subscribe,s.subscriptionId=n),s.userID=i,t&&this.getJSONP.get(t,s,this.callbackName,this.handleUpdateUserResponse.bind(this))}}handleUpdateUserResponse(i){}addToHSListner(i){var t=this;if(null!=t.config.addToHomeSetting&&(1==t.config.addToHomeSetting.allow||1==t.config.addToHomeSetting.desktop_status)){t.config.addToHomeSetting.aths_type.indexOf("0")>=0&&t.beforeInstallPromptHandler(i);var n=null;if(t.config.addToHomeSetting.aths_type.indexOf("2")>=0&&(1==t.config.addToHomeSetting.allow&&1==this.browserController.getMobileStatus()||1==t.config.addToHomeSetting.desktop_status&&0==this.browserController.getMobileStatus())){t.widgetContoller.customAddtoHSBox(t.config.addToHomeSetting),n="nv_pwa_install_action";var s=document.getElementById("notify-visitors-pwa-install-popup-"+t.config.addToHomeSetting.app_id),e=document.getElementById("nv_js-pwa-modal-overlay-"+t.config.addToHomeSetting.app_id);s&&y.push(s),e&&y.push(e)}if((t.config.addToHomeSetting.aths_type.indexOf("1")>=0||1==t.config.addToHomeSetting.desktop_status&&t.config.addToHomeSetting.desktop_btn)&&(0==this.browserController.getMobileStatus()&&t.config.addToHomeSetting.desktop_btn?n=n?t.config.addToHomeSetting.desktop_btn+"|"+n:t.config.addToHomeSetting.desktop_btn:t.config.addToHomeSetting.aths_btnID&&(n=n?t.config.addToHomeSetting.aths_btnID+"|"+n:t.config.addToHomeSetting.aths_btnID)),null==n)return;n.split("|").forEach(n=>{t.addToHomeBtn=document.getElementById(n.trim()),t.addToHomeBtn?(y.push(t.addToHomeBtn),t.bindEvent.bind(t.addToHomeBtn,"click",t.addToHomeBtnClickHandler,t.productName),t.beforeInstallPromptHandlerDiffer(i)):console.log("Error:: no button found")})}}beforeInstallPromptHandlerDiffer(i){this.beforeInstallPromptEvent=i,this.addToHomeBtn.style.display="block",this.config.addToHomeSetting.aths_type&&this.config.addToHomeSetting.aths_type.indexOf("0")<0&&i.preventDefault(),0==this.webappShown&&(this.webappShown=1,this.sendStats("web_app_shown",!0),this.gapush_push("web_app_shown",this.data.setting.app_id||"",!0),this.callbackNotifyEvent.send("shown","web_app_event"))}beforeInstallPromptHandler(i){0==this.webappShown&&(this.webappShown=1,this.sendStats("web_app_shown",!0),this.gapush_push("web_app_shown",this.data.setting.app_id||"",!0),this.callbackNotifyEvent.send("shown","web_app_event")),this.bindEvent.bind(window,"appinstalled",i=>{if(y.length>0&&y.forEach(function(i){i.style.display="none"}),null==S){this.sendStats("web_app_installed",!1),this.gapush_push("web_app_installed",this.data.setting.app_id||"",!1),this.callbackNotifyEvent.send("installed","web_app_event");try{nv("event","web_app_install","",1,1)}catch(i){console.log(i)}S=!0}},this.productName),i.userChoice.then(function(i){if("dismissed"==i.outcome)this.sendStats("web_app_canceled",!1),this.gapush_push("web_app_canceled",this.data.setting.app_id||"",!1),this.callbackNotifyEvent.send("canceled","web_app_event");else if(null==S){this.sendStats("web_app_installed",!1),this.gapush_push("web_app_installed",this.data.setting.app_id||"",!1),this.callbackNotifyEvent.send("installed","web_app_event"),this.beforeInstallPromptEvent=null;try{nv("event","web_app_install","",1,1)}catch(i){console.log(i)}S=!0}}.bind(this)).catch(function(i){console.log(i)})}addToHomeBtnClickHandler(i){this.beforeInstallPromptEvent&&(this.beforeInstallPromptEvent.prompt(),this.beforeInstallPromptHandler(this.beforeInstallPromptEvent))}messageListener(){var i=this;i.bindEvent.bind(window,"message",function(t){try{var n=JSON.parse(t.data);if(n&&"object"==typeof n&&null!=n[0])switch(n[0]){case"nv_push":if("subscribe"==n[1]){var e="200"==n[2]?n[3]:"";i.handlepushSubscription(n[2],e)}break;case"nvpush_nc_confirm":i.widgetContoller.pushConfirmPositive();break;case"nv_centerHeight":s(n[1])}}catch(i){}},i.productName)}athsMessageListener(){var i=this;i.bindEvent.bind(window,"beforeinstallprompt",function(t){if(null==i.config.addToHomeSetting||!(1==i.browserController.getMobileStatus()&&1==i.config.addToHomeSetting.allow||0==i.browserController.getMobileStatus()&&1==i.config.addToHomeSetting.desktop_status))return t.preventDefault(),!1;i.addToHSListner(t)},i.productName)}sendLogs(i){this.config.pushWindowClose=1,i&&(this.config.push_logstat={},this.config.push_logstat=Object.assign({},this.data.auth),"2137"==this.config.push_logstat.bid&&(this.config.push_logstat.log=i,this.getJSONP.get(this.config.urls.push_logstat,this.config.push_logstat,this.callbackName,this.handleStatsResponse.bind(this))))}sendStats(i,t){this.config.pushWindowClose=1,i&&(this.data.setting.isPwa=window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches?1:0,window.notify_visitors.Push.data.add_to_home_details&&window.notify_visitors.Push.data.add_to_home_details.app_id&&(this.data.setting.app_id=window.notify_visitors.Push.data.add_to_home_details.app_id),this.config.pushStats={},this.config.pushStats=Object.assign({},this.data.auth),this.config.pushStats.action=i,this.getJSONP.get(this.config.urls.push_stats,this.config.pushStats,this.callbackName,this.handleStatsResponse.bind(this)))}gapush_push(i,t,n){this.response&&this.response.gaEvents&&Array.isArray(this.response.gaEvents.events)&&this.response.gaEvents.events.includes(i)&&this.gaEvent.send("NV_PushNoitfication","NotifyVisitors",i,t,n)}handleStatsResponse(i){this.config.pushWindowClose=0}handlepushSubscription(i,t){var n=this,s=this.response.cookieDomain?this.response.cookieDomain:"";switch(i){case"202":if(window.notify_visitors.data.session){var e={cookies:{_nv_push_neg:["1",0]},domain:s};window.notify_visitors.data.session(e)}break;case"200":n.pushLeaveIntentController.initialize(t);var o=n.config.pushsubscribe&&n.scope.config.pushsubscribe.event?n.scope.config.pushsubscribe.event:{};nv("event","Push Subscription",o,1,3);break;default:if(window.notify_visitors.data.session){e={cookies:{_nv_push_error:[i,999999999]},domain:s};window.notify_visitors.data.session(e)}}if(null!=window.opener&&-1!=location.href.indexOf("nv_url")){var r=JSON.stringify(["nv_push","subscribe",i,t]);window.opener.postMessage(r,document.referrer),setInterval(function(){n.config.pushWindowClose||self.close()},1e3)}}}return new C(window.notify_visitors.Push.data),C});
